FastSimCoal, a really powerful beast.

1.
	First, do your models as in:
/usit/abel/u1/josece/003_amphilophus_radseq/0_raw_data/10_fasSimCoal/03_fsc_scenarios



2.
	Second, run them 10.000 times..
by doing an array:

arrayrun 1-10000 my_scenario.sh

3. See which one has the .bestlhoods

 for i in $(seq 1 1000); do cat parallel_no_gene_flow_${i}.bestlhoods | grep -v MaxObsLho od | awk -v var=$i '{print var,$NF-$(NF-1)}' | cut -f 1 -d "."; done > ../bestlhood.tsv

#this code let's you go on file 1 .. 2 .. 3 (otherwise unix goes 10000 .. 1000 .. 100 .. 10 .. 1 .. 10001 .. 1001 .. 9)
	#for i in $(seq 1 100000); do cat *.$i.bestlhoods # first you open each file
		# grep -v MaxObsLhood # you get the line you want (the file only has 2 lines)
		# awk -v var=$i '{print var,$NF-$(NF-1)}' #var adds the run_id. $NF-$(NF-1) substracts the end column with the column before so you get the smallest difference between observed and estimated likelihoods
		# cut -f 1 -d "." # to cut the value
		#  > ../best.run.dispersal_gene_flow_citronelus_speciation_is_older.tsv # save

To do this on each model you add another loop.
for j in dispersal_gene_flow_citronelus_speciation_is_older dispersal_no_gene_flow_citronelus_speciation_is_older  hybrid_origin_gene_flow     parallel_gene_flow
dispersal_gene_flow_labiatus_speciation_is_older    dispersal_no_gene_flow_labiatus_speciation_is_older    hybrid_origin_no_gene_flow  parallel_no_gene_flow; do cd $j/bestlhoods; for i in $(seq 1 10000); do cat *.$i.bestlhoods | grep -v MaxObsLhood | awk -v var=$i '{print var,$NF-$(NF-1)}' | cut -f 1 -d "." ; done > ../best.run.${j}.tsv; cd ../..; done


4. Now, we identify the run with the best run so we do some likelihood modeling.

We do this by:

cd $model
sort -k2 best.run.dispersal_gene_flow_citronelus_speciation_is_older.tsv | head

Save the file name ...and search for it in the slurm folder by using grep "null.<file number" slu*

for i in `ls`; do echo $i; cd $i; cat bestlhood.tsv | sort -k 2 | head; cd ..; done

<model>													<run_ID>	<smallest difference between observed and estimated likelihoods>
dispersal_gene_flow_citronelus_speciation_is_older 			<670>		<1842>
dispersal_gene_flow_labiatus_speciation_is_older 			<146>		<1651>
dispersal_no_gene_flow_citronelus_speciation_is_older		<369>		<1956>
dispersal_no_gene_flow_labiatus_speciation_is_older			<545>		<2164>
hybrid_origin_gene_flow 									<117>		<1606>
hybrid_origin_no_gene_flow									<224>		<1604>
parallel_gene_flow 											<455>		<1605>
parallel_no_gene_flow										<189>		<1673>


5. We use the .par file (generated by the best run) and the .obs file (generated in the beginning) and we run fsc 100 times.

cp ../../*par .
cp $obs_file ./${MODEL}_maxL_jointMAFpop1_0.obs
~/000_locally_installed_stuff/fsc26_linux64/fsc26 -i ${MODEL}_maxL.par -n1000000 -m -q -0

6. we get the .lhoods file from each of the 100 runs and format a file with the 100 ML distributions for each model

#run this on the folder where you have all the models (i.e. i=hybrid_etc)
for i in `ls`; do cd $i/; touch ${i}.lhoods; cd best_likelihood_distributions; for j in `ls`; do sed -n '2,3p' $j/*_maxL/*lhoods; done >> ../${i}.lhoods; cd ../..; done

Now plot this over R.
cat: @: No such file or directory
